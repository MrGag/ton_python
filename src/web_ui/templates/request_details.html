<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><![endif]-->
  <title>Анализ тональности</title>
  <meta name="keywords" content="" />
  <meta name="description" content="" />
  <meta name="viewport" content="width=device-width">        
  <link rel="stylesheet" href="static/css/templatemo_main.css">
</head>
<body>
  <div id="main-wrapper">
    <div class="navbar navbar-inverse" role="navigation">
      <div class="navbar-header">
        <div class="logo"><h1>Анализ тональности</h1></div>
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button> 
      </div>   
    </div>
    <div class="template-page-wrapper">

      <div class="templatemo-content-wrapper">
        <div class="templatemo-content">
          <ol class="breadcrumb">
            <li><a href="/">Список запросов</a></li>
            <li class="active">Детализация</li>
          </ol>
          <h1>Детализированное представление запроса</h1>
          <div class="row">
            <div class="col-md-12">
              <h4>Общие характеристки</h4>
              <table class="table table-striped table-hover table-bordered">
                <tr>
                  <td style="width:20%">Дата добавления:</td>
                  <td style="width:80%">{{ton_request.date}}</td>
                </tr>
                <tr>
                  <td style="width:20%">Текст запроса:</td>
                  <td style="width:80%">{{ton_request.name}}</td>
                </tr>
                <tr>
                  <td style="width:20%">Объект тональности:</td>
                  <td style="width:80%">{{ton_request.tonObjects}}</td>
              </table>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <p>Всего документов в запросе: <span class="badge">{{ton_request.count_docs}}</span></p>
            </div>
          </div>
<!--           <div class="row">
            <div class="col-md-12">
              <h4>Общая тональность</h4>
              <p>Кликните на цветную область для отображеня списка соответствющих документов.</p>
            </div>
          </div> -->
          <div class="row">
            <div class="col-md-12">
              <div class="col-md-6" id="pieChart_ton"></div>
              <div class="col-md-6" id="pieChart_docs_tonobj"></div>
              <p style="text-align: center;">Кликните на цветную область для отображеня списка соответствющих документов.</p>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-12">
                {% if type_ton_docs == "pos" %}
                <h4>Список позитивных документов и их тональных предложений (поз./нег.)</h4>
                {% elif type_ton_docs == "neg"%}
                <h4>Список негативных документов и их тональных предложений (поз./нег.)</h4>
                {% elif type_ton_docs == "net"%}
                <h4>Список нейтральных документов (поз./нег.)</h4>
                {% elif type_ton_docs == "all_with_ton_obj"%}
                <h4>Список всех документов с объектом тональности и их тональных предложений (поз./нег.)</h4>
                {% elif type_ton_docs == "all_without_ton_obj"%}
                <h4>Список документов без объекта тональности</h4>
                {% endif %}
                <div class="panel-group" id="accordion">
                  {% for doc in list_docs %}
                  <div class="panel panel-default">
                    <div class="panel-heading" id="panel{{doc.ton}}">
                      <!-- <h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordion" href="#collapse{{doc.i}}">{{doc.name}}</a></h4> -->
                      <h4 class="panel-title"><a href="{{doc.url}}">{{doc.name}}</a></h4>
                    </div>
                    <div id="collapse{{doc.i}}" class="panel-collapse collapse in">
                      <div class="panel-body">
                        {% for sent in doc.ton_sents %}
                          <li class="sent{{sent.sent_ton}}">{{sent.text}} ({{sent.pos}}/{{sent.neg}})</li>
                        {% endfor %}
                      </div>
                    </div>
                  </div>
                  {% endfor %}
                </div>
            </div>
          </div>
        </div>
      </div>

      <footer class="templatemo-footer">
        <div class="templatemo-copyright">
          <p>2014 Системпром</p>
        </div>
      </footer>
    </div>
</div>
    <script src="static/js/jquery.min.js"></script>
    <script src="static/js/bootstrap.min.js"></script>
    <script src="static/js/templatemo_script.js"></script>
    <script src="/static/d3/d3.min.js"></script>
    <script src="/static/d3/d3pie.min.js"></script>
    <script>
      var pie = new d3pie("pieChart_ton", {
        "header": {
          "title": {
            "text": "Распределение тональности в документах",
            "fontSize": 22,
            "font": "verdana"
            }
        },
        "size": {
          "canvasHeight": 350,
          "canvasWidth": 510,
          "pieInnerRadius": "50%",
          "pieOuterRadius": "80%"
        },
        "data": {
          "content": [
            {
              "label": "Положительных",
              "value": {{ton_request.count_pos}},
              "color": "#23c14c"
            },
            {
              "label": "Отрицательных",
              "value": {{ton_request.count_neg}},
              "color": "#a61f1f"
            },
            {
              "label": "Нейтральных",
              "value": {{ton_request.count_net}},
              "color": "#4872eb"
            }
          ]
        },
        "labels": {
          "outer": {
            "format": "label-value2",
            "pieDistance": 32
          },
          "inner": {
            // "format": "none"
          },
          "mainLabel": {
            "font": "verdana",
            "fontSize": 16
          },
          "percentage": {
            "color": "#FFFFFF",
            "font": "verdana",
            "fontSize": 16,
            "decimalPlaces": 0
          },
          "value": {
            "color": "#000000",
            "font": "verdana",
            "fontSize": 16
          },
          "lines": {
            "enabled": true
          }
        },
        "effects": {
          "load": {
            "effect": "none",
            "speed": 100
          },
          "pullOutSegmentOnClick": {
            "effect": "linear",
            "speed": 100,
            "size": 30
          }
        },
        "misc": {
          "gradient": {
            "enabled": true,
            "percentage": 80,
            "color": ""
          }
        },
        "callbacks": {
          onClickSegment: function(seg){
            console.log(seg)
            if (seg.index == 0) {
              window.location.href = "/details?id_req={{id_req}}&docs_ton_type=pos"
            }
            else if (seg.index == 1) {
              window.location.href = "/details?id_req={{id_req}}&docs_ton_type=neg"
            }
            else if (seg.index == 2) {
              window.location.href = "/details?id_req={{id_req}}&docs_ton_type=net"
            }
          }
        }
      });
    </script>

    <script>
      var pie = new d3pie("pieChart_docs_tonobj", {
        "header": {
          "title": {
            "text": "Наличие объекта тональности в документах",
            "fontSize": 22,
            "font": "verdana"
            }
        },
        "size": {
          "canvasHeight": 350,
          "canvasWidth": 510,
          "pieInnerRadius": "50%",
          "pieOuterRadius": "80%"
        },
        "data": {
          "content": [
            {
              "label": "Есть",
              "value": {{ton_request.docs_with_ton_obj}},
              "color": "#996633"
            },
            {
              "label": "Нет",
              "value": {{ton_request.docs_without_ton_obj}},
              "color": "#663300"
            }
          ]
        },
        "labels": {
          "outer": {
            "format": "label-value2",
            "pieDistance": 32
          },
          "inner": {
            // "format": "none"
          },
          "mainLabel": {
            "font": "verdana",
            "fontSize": 16
          },
          "percentage": {
            "color": "#FFFFFF",
            "font": "verdana",
            "fontSize": 16,
            "decimalPlaces": 0
          },
          "value": {
            "color": "#000000",
            "font": "verdana",
            "fontSize": 16
          },
          "lines": {
            "enabled": true
          }
        },
        "effects": {
          "load": {
            "effect": "none",
            "speed": 100
          },
          "pullOutSegmentOnClick": {
            "effect": "linear",
            "speed": 100,
            "size": 30
          }
        },
        "misc": {
          "gradient": {
            "enabled": true,
            "percentage": 80,
            "color": ""
          }
        },
        "callbacks": {
          onClickSegment: function(seg){
            if (seg.index == 0) {
              window.location.href = "/details?id_req={{id_req}}&docs_ton_type=all_with_ton_obj"
            }
            else if (seg.index == 1) {
              window.location.href = "/details?id_req={{id_req}}&docs_ton_type=all_without_ton_obj"
            }
          }
        }
      });
    </script>
  </body>
</html>